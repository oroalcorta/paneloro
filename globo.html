<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>CASINO ORO ‚Äî GLOBO</title>
<style>
  :root{
    --bg:#0b1020; --panel:#0f1628; --stroke:#26304a; --ink:#e9eefc;
    --green:#24e07a; --green-d:#0ea763; --cyan:#3ee7ff;
    --radius:16px;
  }
  *{box-sizing:border-box}
  html,body{margin:0;height:100%;background:linear-gradient(135deg,#0a1022,#0f1832);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto}
  .wrap{min-height:100dvh;display:flex;flex-direction:column;align-items:center;gap:12px;padding:12px}
  .panel{width:100%;max-width:980px;background:var(--panel);border:1px solid var(--stroke);border-radius:var(--radius);box-shadow:0 12px 28px rgba(0,0,0,.35);padding:12px}

  h1{font-size:1.1rem;margin:2px 0;text-align:center}
  h2{font-size:.95rem;margin:0;text-align:center}

  /* juego */
  .game{display:grid;grid-template-columns:1fr 260px;gap:10px;width:100%}
  @media(max-width:820px){ .game{grid-template-columns:1fr} }

  .stage{display:flex;align-items:center;justify-content:center;padding:6px}
  .top-chips{display:flex;gap:6px;justify-content:center;flex-wrap:wrap;margin-bottom:6px}
  .chip{background:#101a2b;border:1px solid #22354f;border-radius:10px;padding:6px 10px;font-weight:800;opacity:.65;font-size:.9rem}
  .chip.active{background:#1dd35e;color:#062a12;border-color:#0ea763;opacity:1}
  .chip.future{opacity:.9}

  .side{display:flex;flex-direction:column;gap:8px}
  .pill{background:#0b1324;border:1px solid #22304a;border-radius:12px;padding:8px 10px;font-size:.82rem}
  .val{color:var(--cyan)}
  .row{display:flex;gap:6px;align-items:center;flex-wrap:wrap}
  .status{background:#0b1324;border:1px solid #22304a;border-radius:12px;padding:8px;min-height:48px;font-size:.88rem}
  .btn{border:none;border-radius:12px;padding:12px 14px;font-weight:800;cursor:pointer;text-align:center}
  .btn-green{background:linear-gradient(180deg,var(--green),#14c16a);color:#00160c;box-shadow:0 6px 0 var(--green-d)}
  .btn-gold{background:linear-gradient(180deg,var(--cyan),#13c1d6);color:#07161a;box-shadow:0 6px 0 #0a7b8a}
  .btn:disabled{opacity:.55;filter:grayscale(.15);cursor:not-allowed}

  /* RIG Globo */
  .rig{
    position:relative;
    width:min(78vw,460px);
    height:clamp(240px,34vh,340px);
    background:linear-gradient(180deg,#0a1524 40%, #0c1b30 100%);
    border:1px solid #1b2742;border-radius:14px;
    box-shadow:inset 0 0 40px rgba(0,0,0,.35);
    margin:auto;
  }
  #fx-canvas{position:fixed; inset:0; width:100vw; height:100vh; pointer-events:none; z-index:99998}
  .fx-flash{position:fixed; inset:0; background:rgba(255,255,255,.75); pointer-events:none; z-index:99997; animation:fxflash .18s ease-out both}
  @keyframes fxflash { from{opacity:.9} to{opacity:0} }

  .nozzle{
    --noz-bottom: 9%; --noz-h: 46px;
    position:absolute; left:50%; transform:translateX(-50%); bottom: var(--noz-bottom);
    width:58px; height: var(--noz-h);
    background:#152132; border-radius:18px 18px 10px 10px; border:1px solid #253650; box-shadow:inset 0 6px 18px rgba(0,0,0,.45);
    z-index:1;
  }
  .nozzle::after{
    content:""; position:absolute; left:50%; transform:translateX(-50%); bottom: calc(var(--noz-h) - 12px);
    width:20px; height:26px; background:#101b2b; border-radius:6px; border:1px solid #20334e;
  }

  .balloon{
    --scale:0.13;
    position:absolute; left:50%;
    bottom: calc(var(--noz-bottom,9%) + var(--noz-h,46px) - 6px);
    transform-origin:50% 100%;
    width:240px; height:300px;
    border-radius:50% 50% 46% 46%/56% 56% 44% 44%;
    transform:translateX(-50%) scale(var(--scale));
    background:radial-gradient(120px 160px at 68% 28%, #ff7a8a 0%, #e62d45 38%, #bf1730 75%, #9b0e24 100%);
    box-shadow:0 24px 60px rgba(255,70,94,.18);
    transition:transform .55s cubic-bezier(.2,.9,.2,1), filter .25s;
    z-index:2;
  }
  .shine{position:absolute;top:18%;left:62%;width:64px;height:64px;border-radius:50%;
    background:radial-gradient(circle, rgba(255,255,255,.95) 0%, rgba(255,255,255,.25) 60%, transparent 70%);
    filter:blur(.4px);opacity:.85;transform:rotate(-12deg)}
  .neck{position:absolute;left:50%;bottom:-26px;transform:translateX(-50%);width:28px;height:36px;background:#9b0e24;border-radius:6px;border:2px solid #7d0b1d}
  .balloon.pop{ animation:pop .42s ease-out forwards }
  @keyframes pop{ 0%{transform:translateX(-50%) scale(var(--scale)); filter:brightness(1)}
                  60%{transform:translateX(-50%) scale(calc(var(--scale) * 1.22)); filter:brightness(1.15)}
                  100%{transform:translateX(-50%) scale(.02); filter:brightness(.8); opacity:0} }
  .meter{ position:absolute;left:0;right:0;top:8px;text-align:center;
          font-size:clamp(1.4rem,5.2vw,1.9rem); font-weight:800;letter-spacing:.5px; text-shadow:0 2px 10px rgba(0,0,0,.45) }
  .meter.good{ color:#9fffbf } .meter.bad{ color:#ff7171 }

  /* modal */
  #overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.65);z-index:100000;align-items:center;justify-content:center;padding:16px}
  #modal{width:min(520px,92vw);background:#0f1628;border:1px solid #26304a;border-radius:16px;box-shadow:0 18px 40px rgba(0,0,0,.6);padding:18px;text-align:center}
  #modal-title{font-weight:800;font-size:1.05rem;margin-bottom:8px}
  #modal-msg{opacity:.9;margin-bottom:14px}
  canvas#confeti{position:fixed;inset:0;pointer-events:none;z-index:99999}
</style>
</head>
<body>
<div class="wrap">
  <div id="p2" class="panel" role="main" aria-label="Juego">
    <div style="font-size:.78rem;opacity:.85;margin:-2px 0 8px;align-self:flex-start">üèõÔ∏è <b>CASINO ORO</b> ‚Äî <b>GLOBO</b></div>

    <div class="game">
      <!-- Stage -->
      <div>
        <div id="chips" class="top-chips"></div>
        <div class="rig stage">
          <div class="meter" id="meter">1.00√ó</div>
          <div id="balloon" class="balloon">
            <div class="shine"></div><div class="neck"></div>
          </div>
          <div class="nozzle"></div>
        </div>
      </div>

      <!-- Sidebar -->
      <div class="side">
        <div class="pill">üë§ JUGADOR<br><span id="hud-user" class="val">-</span></div>
        <div class="pill">üóìÔ∏è FECHA/HORA (ARG)<br><span id="hud-date" class="val">-</span></div>

        <div class="pill">
          <div class="row" style="justify-content:space-between"><span class="label" style="margin:0">APUESTA BASE</span><span id="hud-bet" class="val">$1.000</span></div>
          <div class="row" style="justify-content:space-between;margin-top:6px"><span class="label" style="margin:0">CHANCES</span><span id="hud-chances" class="val">3/3</span></div>
        </div>

        <div class="pill">üí∞ PAGO TOTAL <span id="hud-mult" class="val">(1.00√ó)</span><br><span id="hud-gain" class="val">$1.000</span></div>

        <div id="status" class="status">Toc√° INFLAR para empezar. Si estalla antes de retirarte, cobr√°s la base $1.000.</div>

        <div class="row" style="gap:8px">
          <button id="btn-inflar" class="btn btn-green" style="flex:1">INFLAR üéà</button>
          <button id="btn-ret" class="btn btn-gold" style="flex:1" disabled>RETIRARSE üí∞</button>
        </div>
        <button id="btn-retry" class="btn" style="margin-top:6px;display:none;background:#26354f;color:#e9eefc">NUEVA RONDA ‚ü≥</button>
      </div>
    </div>
  </div>
</div>

<!-- FX -->
<canvas id="fx-canvas"></canvas>
<canvas id="confeti"></canvas>
<div id="overlay">
  <div id="modal">
    <div id="modal-title">Resultado</div>
    <div id="modal-msg"></div>
    <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap">
      <button id="modal-close" class="btn btn-gold">CERRAR</button>
    </div>
  </div>
</div>

<script>
/* ====== Util ====== */
const USER = new URLSearchParams(location.search).get('user') || '';
const $ = s => document.querySelector(s);
const toMoney = n => '$' + Number(Math.round(n)).toLocaleString('es-AR');
function fechaHoraAR(){
  const tz='America/Argentina/Buenos_Aires';
  return new Intl.DateTimeFormat('es-AR',{timeZone:tz,year:'2-digit',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:false}).format(new Date());
}
function startClock(){ const el=$('#hud-date'); const tick=()=>{ el.textContent=fechaHoraAR() }; tick(); clearInterval(window.__clk); window.__clk=setInterval(tick,1000); }

/* ====== Explosi√≥n FX minimal (sin dependencias) ====== */
(()=>{ // ExplosionFX.explodeAt(el,{...})
  const canvas = document.getElementById('fx-canvas');
  const ctx = canvas.getContext('2d');
  let W = canvas.width = innerWidth, H = canvas.height = innerHeight;
  addEventListener('resize', ()=>{ W=canvas.width=innerWidth; H=canvas.height=innerHeight; });
  const parts=[]; let running=false;
  function rand(a,b){ return a+Math.random()*(b-a) }
  function loop(){
    if(!running) return;
    ctx.clearRect(0,0,W,H);
    for(let i=parts.length-1;i>=0;i--){
      const p=parts[i]; p.vx+=p.ax; p.vy+=p.ay; p.x+=p.vx; p.y+=p.vy; p.life-=p.decay;
      ctx.globalAlpha=Math.max(0,p.life/p.life0); ctx.fillStyle=p.color;
      ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill();
      if(p.life<=0) parts.splice(i,1);
    }
    if(parts.length===0){ running=false; ctx.clearRect(0,0,W,H); return; }
    requestAnimationFrame(loop);
  }
  function explodeAt(el){
    const r=el.getBoundingClientRect(), cx=r.left+r.width/2, cy=r.top+r.height/2;
    for(let i=0;i<120;i++){
      parts.push({x:cx,y:cy,vx:rand(-2,2),vy:rand(-2,2),ax:rand(-.02,.02),ay:.05,r:rand(1.5,3.5),life:rand(.6,1.2),life0:1,color: Math.random()>.5?'#D4AF37':'#3ee7ff',decay:rand(.02,.05)});
    }
    if(!running){ running=true; requestAnimationFrame(loop); }
  }
  window.ExplosionFX={ explodeAt };
})();

/* ====== Juego ====== */
const BET = 1000;
const MULTS = [1.00, 1.63, 2.80, 4.95, 9.08, 17.34, 34.68, 73.21, 164.72];
const CUM_PROB = [100.000000, 60.000000, 35.000000, 19.782609, 10.790514, 5.652174, 2.826087, 1.338673, 0.594966];
// supervivencia paso a paso
const STEP_SURV = CUM_PROB.map((p,i)=> i===CUM_PROB.length-1 ? 0 : (CUM_PROB[i+1]/CUM_PROB[i]));

let jugando=false, terminado=false;
let step=0, bustAt=Infinity, mult=1.00;

const MAX_CHANCES=3; let chancesLeft=MAX_CHANCES; let roundConsumed=false;

const chipsEl=$('#chips'), meter=$('#meter'), balloon=$('#balloon');
const hudUser=$('#hud-user'), hudBet=$('#hud-bet'), hudGain=$('#hud-gain'), hudMult=$('#hud-mult'), hudChances=$('#hud-chances'), statusEl=$('#status');
const btnInflar=$('#btn-inflar'), btnRet=$('#btn-ret'), btnRetry=$('#btn-retry');
const overlay=$('#overlay'), modalTitle=$('#modal-title'), modalMsg=$('#modal-msg'), modalClose=$('#modal-close');
function renderChips(){ chipsEl.innerHTML=''; for(let i=0;i<MULTS.length;i++){ const c=document.createElement('div'); c.className='chip'+(i===step?' active':' future'); c.textContent=MULTS[i].toFixed(2)+'√ó'; chipsEl.appendChild(c); } }
function setMeter(x, good=false, bad=false){ meter.textContent=x.toFixed(2)+'√ó'; meter.classList.toggle('good',good); meter.classList.toggle('bad',bad); }
function setBalloonScale(){ const t=step/(MULTS.length-1); const base=0.11, range=0.54; const scale=base+t*range; balloon.style.setProperty('--scale', scale.toFixed(3)); }
function setHUD(){ hudBet.textContent=toMoney(BET); hudGain.textContent=toMoney(Math.round(BET*mult)); hudMult.textContent=`(${mult.toFixed(2)}√ó)`; hudChances.textContent=`${chancesLeft}/${MAX_CHANCES}`; }
function lockAll(){ btnInflar.disabled=true; btnRet.disabled=true; btnRetry.style.display='none'; document.querySelector('.rig').style.pointerEvents='none'; }

function resetRound(){
  jugando=true; terminado=false; roundConsumed=false; step=0; mult=1.00;
  setMeter(mult); setHUD(); setBalloonScale(); balloon.classList.remove('pop');
  btnInflar.disabled=false; btnRet.disabled=true; btnRetry.style.display='none'; statusEl.textContent='Infl√° para empezar. Retirate cuando quieras.';
  renderChips();
  // c√°lculo de bust con supervivencias condicionadas
  let s=0; while(s<STEP_SURV.length && Math.random()<STEP_SURV[s]) s++; bustAt=s+1;
}

function noChancesLeft(){ btnInflar.disabled=true; btnRet.disabled=true; btnRetry.style.display='none'; statusEl.textContent='‚õî No te quedan chances.'; }

function showResult(win, payout){
  modalTitle.textContent = win ? '¬°Felicidades! üéâ' : 'Qu√© l√°stima üòî';
  modalMsg.innerHTML = win ? `Cobraste <b>${toMoney(payout)}</b>.` : `Estall√≥ el globo. Te qued√°s con la base de <b>${toMoney(payout)}</b>.`;
  overlay.style.display='flex'; modalClose.onclick=()=> overlay.style.display='none';

  // Notificar al panel (opcional)
  try{
    window.parent && window.parent.postMessage({
      type:'prize', game:'globo', user:USER, label: win? `GANANCIA ${toMoney(payout)}` : `BASE ${toMoney(payout)}`, value: payout
    }, '*');
  }catch(e){}
}

function estallar(){
  terminado=true; jugando=false;
  btnInflar.disabled=true; btnRet.disabled=true;
  setMeter(mult,false,true); statusEl.textContent='üí• ¬°Estall√≥!';
  ExplosionFX.explodeAt(balloon); balloon.classList.add('pop');

  if(chancesLeft>0){ btnRetry.style.display='block'; statusEl.textContent=`üí• Estall√≥. Te quedan ${chancesLeft} chance(s). Toc√° "NUEVA RONDA".`; return; }

  lockAll();
  setTimeout(()=> showResult(false, BET), 800);
}

btnInflar.onclick = ()=>{
  if(!jugando || terminado) return;
  if(!roundConsumed){ if(chancesLeft<=0){ noChancesLeft(); return; } chancesLeft-=1; roundConsumed=true; setHUD(); }
  const next = step + 1;
  if(next === bustAt){ estallar(); return; }
  if(step < MULTS.length-1){
    step = next; mult = MULTS[step]; setBalloonScale(); setMeter(mult,true,false); setHUD(); renderChips();
    btnRet.disabled = (step===0); statusEl.textContent='Segu√≠s subiendo‚Ä¶ ¬°pod√©s retirarte cuando quieras!';
  } else {
    btnInflar.disabled=true; statusEl.textContent='Llegaste al m√°ximo. Retirate para cobrar.';
  }
};

btnRet.onclick = ()=>{
  if(!jugando || terminado) return;
  terminado=true; jugando=false;
  chancesLeft = 0; lockAll();
  const payout = Math.round(BET * mult);
  statusEl.textContent = `üéâ ¬°Cobraste ${toMoney(payout)}!`;
  showResult(true, payout);
};

btnRetry.onclick = ()=>{
  if(chancesLeft<=0){ noChancesLeft(); return; }
  resetRound();
};

/* INIT */
(function init(){
  $('#hud-user').textContent = USER || '-';
  startClock();
  renderChips();
  resetRound();
})();
</script>
</body>
</html>